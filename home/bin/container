#!/usr/bin/env bash

CLOUD_INIT_SCRIPT="/tmp/cloud-init.yaml"
CONTAINER_NAME="mybuntu"


if podman ps --filter "name=$CONTAINER_NAME" --format "{{.Names}}" | grep -wq "$CONTAINER_NAME"; then
  echo "$CONTAINER_NAME is already running, attaching..."
  podman exec -it "$CONTAINER_NAME" bash
  exit 0
elif podman ps -a --filter "name=$CONTAINER_NAME" --format "{{.Names}}" | grep -wq "$CONTAINER_NAME"; then
  podman start -ai "$CONTAINER_NAME"
  exit 0
else
  echo "$CONTAINER_NAME not found, building..."
fi

podman pull ubuntu

podman run -it \
  --name "$CONTAINER_NAME" \
  --hostname "$CONTAINER_NAME" \
  --volume "$HOME:$HOME" \
  --env "$USER" \
  --env "$HOME" \
  --workdir "$HOME" \
  --replace \
  ubuntu
