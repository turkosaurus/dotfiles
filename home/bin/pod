#!/usr/bin/env bash

if [[ -z "$1" ]]; then
	echo "usage: $0 <dockerfile>"
	exit 1
fi

path="$1"
dockerfile="$(basename "$path")"
name="${dockerfile#*.}"
echo "$name"

if ! podman build -t "$name" -f "$path"; then
	echo "error: build image from $path"
	exit 1
fi

# TODO: mount volumes
# TODO: install and init dotfiles
if ! podman run --replace --volume --name "$name" --hostname "$name" -it "$name"; then
	echo "error: run image $name"
	exit 1
fi
